from distutils import sysconfig
from distutils.errors import DistutilsPlatformError
from distutils.util import is_mingw, split_quoted


from .. import cygwin, errors


class TestMinGW32Compiler:
        compiler = cygwin.MinGW32Compiler()
        assert compiler.compiler_type == 'mingw32'

        monkeypatch.setenv('CC', 'cc')
        monkeypatch.setenv('CXX', 'c++')

        compiler = cygwin.MinGW32Compiler()

        assert compiler.compiler == split_quoted('cc -O -Wall')
        assert compiler.compiler_so == split_quoted('cc -shared -O -Wall')
        assert compiler.compiler_cxx == split_quoted('c++ -O -Wall')
        assert compiler.linker_exe == split_quoted('cc')
        assert compiler.linker_so == split_quoted('cc -shared')

        compiler = cygwin.MinGW32Compiler()
            compiler.runtime_library_dir_option('/usr/lib')

        monkeypatch.setattr(cygwin, 'is_cygwincc', lambda _: True)

            cygwin.MinGW32Compiler()

        # In case we have an MSVC Python build, but still want to use
        # MinGW32Compiler, then customize_compiler() shouldn't fail at least.
        # https://github.com/pypa/setuptools/issues/4456
        compiler = cygwin.MinGW32Compiler()
        sysconfig.customize_compiler(compiler)
